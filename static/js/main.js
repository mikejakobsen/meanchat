"use strict";var app={rooms:function(){var e=io("/rooms",{transports:["websocket"]});e.on("connect",function(){e.on("updateRoomsList",function(e){$(".room-create p.message").remove(),null!=e.error?$(".room-create").append('<p class="message error">'+e.error+"</p>"):app.helpers.updateRoomsList(e)}),$(".room-create button").on("click",function(){var t=$("input[name='title']");""!==t.val()&&(e.emit("createRoom",t.val()),t.val(""))})})},chat:function(e,t){var s=io("/chatroom",{transports:["websocket"]});s.on("connect",function(){s.emit("join",e),s.on("updateUsersList",function(e,t){$(".container p.message").remove(),null!=e.error?$(".container").html('<p class="message error">'+e.error+"</p>"):app.helpers.updateUsersList(e,t)}),$(".chat-message button").on("click",function(){var n=$("textarea[name='message']");if(""!==n.val()){var a={content:n.val(),username:t,date:Date.now()};s.emit("newMessage",e,a),n.val(""),app.helpers.addMessage(a),console.log(a)}}),s.on("removeUser",function(e){$("li#user-"+e).remove(),app.helpers.updateNumOfUsers()}),s.on("addMessage",function(e){app.helpers.addMessage(e)})})},helpers:{encodeHTML:function(e){return $("<div />").text(e).html()},updateRoomsList:function(e){e.title=this.encodeHTML(e.title);var t='<a href="/chat/'+e._id+'"><li class="room-item">'+e.title+"</li></a>";""!==t&&($(".room-list ul li").length>0?$(".room-list ul").prepend(t):$(".room-list ul").html("").html(t),this.updateNumOfRooms())},updateUsersList:function(e,t){e.constructor!==Array&&(e=[e]);var s="",n=!0,a=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var l=r.value;l.username=this.encodeHTML(l.username),s+='<li class="clearfix" id="user-'+l._id+'">\n                <img src="'+l.picture+'" alt="'+l.username+'" />\n                <div class="about">\n                <div class="name">'+l.username+'</div>\n                <div class="status"><p class="online">Online</p></div>\n                </div></li>'}}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}""!==s&&(null!=t&&1==t?$(".users-list ul").html("").html(s):$(".users-list ul").prepend(s),this.updateNumOfUsers())},addMessage:function(e){e.date=new Date(e.date).toLocaleString(),console.log(e.date),e.username=this.encodeHTML(e.username),console.log(e.username),e.content=this.encodeHTML(e.content),console.log(e.content);var t='<li>\n            <div class="message-data">\n            <span class="message-data-name">'+e.username+'</span>\n            <span class="message-data-time">'+e.date+'</span>\n            </div>\n            <div class="message my-message" dir="auto">'+e.content+"</div>\n            </li>";$(t).hide().appendTo(".chat-history ul").slideDown(200),$(".chat-history").animate({scrollTop:$(".chat-history")[0].scrollHeight},1e3)},saveMessage:function(e){e.date=new Date(e.date).toLocaleString(),e.username=this.encodeHTML(e.username),e.content=this.encodeHTML(e.content),console.log(e.date,e.username,e.content)},updateNumOfRooms:function(){var e=$(".room-list ul li").length;$(".room-num-rooms").text(e+" Room(s)")},updateNumOfUsers:function(){var e=$(".users-list ul li").length;$(".chat-num-users").text(e+" User(s)")}}};