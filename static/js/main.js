"use strict";var app={rooms:function(){var e=io("/rooms",{transports:["websocket"]});e.on("connect",function(){e.on("updateRoomsList",function(e){$(".room-create p.message").remove(),null!=e.error?$(".room-create").append('<p class="message error">'+e.error+"</p>"):app.helpers.updateRoomsList(e)}),$(".room-create button").on("click",function(){var s=$("input[name='title']");""!==s.val()&&(e.emit("createRoom",s.val()),s.val(""))})})},chat:function(e,s){var a=io("/chatroom",{transports:["websocket"]});a.on("connect",function(){a.emit("join",e),a.on("updateUsersList",function(e,s){$(".container p.message").remove(),null!=e.error?$(".container").html('<p class="message error">'+e.error+"</p>"):app.helpers.updateUsersList(e,s)}),$(".chat-message button").on("click",function(){var t=$("textarea[name='message']");if(""!==t.val()){var n={content:t.val(),username:s,date:Date.now()};a.emit("newMessage",e,n),t.val(""),app.helpers.addMessage(n),console.log(n)}}),a.on("removeUser",function(e){$("li#user-"+e).remove(),app.helpers.updateNumOfUsers()}),a.on("addMessage",function(e){app.helpers.addMessage(e)})})},helpers:{encodeHTML:function(e){return $("<div />").text(e).html()},updateRoomsList:function(e){e.title=this.encodeHTML(e.title);var s='<a href="/chat/'+e._id+'"><li class="room-item">'+e.title+"</li></a>";""!==s&&($(".room-list ul li").length>0?$(".room-list ul").prepend(s):$(".room-list ul").html("").html(s),this.updateNumOfRooms())},updateUsersList:function(e,s){e.constructor!==Array&&(e=[e]);var a="",t=!0,n=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var l=r.value;l.username=this.encodeHTML(l.username),a+='<li class="clearfix" id="user-'+l._id+'">\n                <img src="'+l.picture+'" alt="'+l.username+'" />\n                <div class="about">\n                <div class="name">'+l.username+'</div>\n                <div class="status"><i class="fa fa-circle online"> Online</i></div>\n                </div></li>'}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}""!==a&&(null!=s&&1==s?$(".users-list ul").html("").html(a):$(".users-list ul").prepend(a),this.updateNumOfUsers())},addMessage:function(e){if(e.date=new Date(e.date).toLocaleString(),e.username=this.encodeHTML(e.username),e.content=this.encodeHTML(e.content),e.username!=e.username)var s='<li>\n                <div class="message-data-away">\n                <span class="message-data-name-away">'+e.username+'</span>\n                <span class="message-data-time-away">'+e.date+'</span>\n                </div>\n                <div class="message-away my-message-away" dir="auto">'+e.content+"</div>\n                </li>";else var s='<li>\n                <div class="message-data">\n                <span class="message-data-name">'+e.username+'</span>\n                <span class="message-data-time">'+e.date+'</span>\n                </div>\n                <div class="message my-message" dir="auto">'+e.content+"</div>\n                </li>";$(s).hide().appendTo(".chat-history ul").slideDown(200),$(".chat-history").animate({scrollTop:$(".chat-history")[0].scrollHeight},1e3)},updateNumOfRooms:function(){var e=$(".room-list ul li").length;$(".room-num-rooms").text(e+" Room(s)")},updateNumOfUsers:function(){var e=$(".users-list ul li").length;$(".chat-num-users").text(e+" User(s)")}}};